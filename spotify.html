<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Que estoy escuchando</title>
    <link rel="stylesheet" href="https://unpkg.com/98.css@0.1.20/dist/98.css" integrity="sha256-Yi4UMGpJwUoZ9Pwp6VaBZBNAJOQh1rJrjBNFPqqn9PQ=" crossorigin="anonymous">
</head>
<body onload="init();">
    <div class="window">
        <div class="title-bar">
          <div class="title-bar-text">¿Que está escuchando Eze?</div>
          <div class="title-bar-controls">
            <button aria-label="Minimize"></button>
            <button aria-label="Maximize"></button>
            <button aria-label="Close"></button>
          </div>
        </div>
        <div class="window-body">
          <p>Vista en vivo via API de Spotify</p>
          <div class="sunken-panel" style="height: 7rem;">
            <table class="interactive">
              <thead>
                <tr>
                  <th>Titulo</th>
                  <th>Artista</th>
                  <th>Album</th>
                  <th>Cover</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td id="sp_title">Cargando...</td>
                  <td id="sp_artist">Cargando...</td>
                  <td id="sp_album">Cargando...</td>
                  <td id="sp_cover">Cargando...</td>
                </tr>
              </tbody>
            </table>
          </div>
          <button class="default" style="margin-top: 0.25rem;" id="sp_button">Escuchar tema</button>
        </div>
      </div>
      <script>
        document.querySelectorAll('table.interactive').forEach(element => {
          element.addEventListener('click', (event) => {
            const highlightedClass = 'highlighted';
            const isRow = element => element.tagName === 'TR' && element.parentElement.tagName === 'TBODY';
            const newlySelectedRow = event.composedPath().find(isRow);
            const previouslySelectedRow = Array.from(newlySelectedRow.parentElement.children).filter(isRow).find(element => element.classList.contains(highlightedClass));
            if(previouslySelectedRow){
              previouslySelectedRow.classList.toggle(highlightedClass);
            }
      
            if (newlySelectedRow) {
              newlySelectedRow.classList.toggle(highlightedClass);
            }
          })
        });
      </script>
      <script>
         async function init() {
            const e_title = document.getElementById("sp_title");
            const e_artist = document.getElementById("sp_artist");
        
            const e_cover = document.getElementById("sp_cover");
            const e_album = document.getElementById("sp_album");
            const song = await fetch('https://walter.eze.net.ar', {
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                }
            }).then(response => response.json());
            if (song?.error) {
                return;
            }
            e_title.innerHTML = song.title;
            e_artist.innerHTML = song.artist;
            e_cover.innerHTML = `<img src=${song.albumArt} alt="${song.artist} - ${song.title}" style="width: 100%; height: 100%;">`;
            e_album.innerHTML = song.album;

        }
      </script>
</body>
</html>